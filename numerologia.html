<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Numerología · AURUM∞</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="lemuria.css">
  <style>
    /* Contexto */
    .ctx-wrap{position:sticky;top:0;z-index:999;background:linear-gradient(180deg,#0e1e21 0%,#0f1e21ee 100%);border-bottom:1px solid rgba(212,175,55,.25);box-shadow:0 6px 14px rgba(0,0,0,.25);backdrop-filter:blur(6px)}
    .ctx{max-width:1100px;margin:0 auto;padding:12px 16px;display:grid;grid-template-columns:1fr 1fr;gap:10px 16px;align-items:center;color:#e9ecf1;font-size:.95rem}
    .ctx b{color:#f1c84c}.ctx input{width:100%;padding:6px 10px;border-radius:8px;border:1px solid rgba(212,175,55,.35);background:#0f1e21;color:#e9ecf1}
    .ctx .mini{display:flex;flex-wrap:wrap;gap:10px}.ctx .pill{padding:6px 10px;border:1px solid rgba(212,175,55,.35);border-radius:999px;color:#f1c84c;text-decoration:none}
    .ctx .pill.active{background:#1b2a2e;border-color:#f1c84c}.ctx .btn{background:#f1c84c;color:#0f1e21;border:none;border-radius:10px;padding:6px 10px;font-weight:700;cursor:pointer}
    @media (max-width:720px){.ctx{grid-template-columns:1fr}}
    /* Página */
    main{max-width:1000px;margin:24px auto;padding:0 16px}
    .card{background:#0f1e21;border:1px solid rgba(212,175,55,.25);border-radius:14px;padding:18px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    .field input{background:#0f1e21;border:1px solid rgba(212,175,55,.35);border-radius:10px;color:#e9ecf1;padding:12px 14px}
    .btn{background:#f1c84c;color:#0f1e21;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .kpi{display:grid;grid-template-columns:repeat(5,minmax(120px,1fr));gap:12px;margin-top:10px}
    @media (max-width:900px){.kpi{grid-template-columns:repeat(2,1fr)}}
    .k{background:#0f1e21;border:1px solid rgba(212,175,55,.25);border-radius:12px;padding:12px}
    .k .n{font-size:2rem;font-weight:900;color:#f1c84c}
    table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:12px}
    th,td{padding:10px 12px;background:#0f1e21;border:1px solid rgba(212,175,55,.2)}
    th{color:#f1c84c}
  </style>
</head>
<body>
<!-- Contexto -->
<div class="ctx-wrap"><div class="ctx">
  <div><label><b>ID Activo</b></label><input id="ctx-id" placeholder="Opcional para enlazar persona→activo"></div>
  <div><label><b>Nombre</b></label><input id="ctx-name" placeholder="Ej: Toyota Hilux (opcional)"></div>
  <div><label><b>Operador</b></label><input id="ctx-op" placeholder="Ej: Tu nombre"></div>
  <div class="mini">
    <a class="pill" href="checklist.html">Checklist 3D</a>
    <a class="pill" href="trazabilidad.html">Trazabilidad</a>
    <a class="pill active" href="numerologia.html">Numerología</a>
    <a class="pill" href="hilux.html">Hilux 3D</a>
    <button class="btn" id="ctx-clear">Limpiar</button>
  </div>
</div></div>

<main>
  <h1>Numerología Vibracional</h1>
  <div class="card grid">
    <div>
      <div class="field"><label>Nombre completo</label><input id="fullname" placeholder="Ej: ANDRÉS BELLO"></div>
      <div class="field"><label>Fecha de nacimiento (DD/MM/AAAA)</label><input id="birth" placeholder="21/08/1988"></div>
      <button class="btn" id="calc">Calcular</button>
    </div>
    <div>
      <div class="kpi">
        <div class="k"><div class="n" id="k_life">—</div><div>Camino de Vida</div></div>
        <div class="k"><div class="n" id="k_expr">—</div><div>Expresión / Destino</div></div>
        <div class="k"><div class="n" id="k_soul">—</div><div>Alma (Vocales)</div></div>
        <div class="k"><div class="n" id="k_pers">—</div><div>Personalidad (Consonantes)</div></div>
        <div class="k"><div class="n" id="k_year">—</div><div>Año Personal</div></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>Desglose del nombre</h3>
    <table id="tbl"><thead><tr><th>Segmento</th><th>Texto</th><th>Suma</th><th>Reducción</th></tr></thead><tbody></tbody></table>
  </div>
</main>

<script>
/* Contexto mínimo */
(function(){const $=s=>document.querySelector(s),id=$('#ctx-id'),nm=$('#ctx-name'),op=$('#ctx-op');
const saved=JSON.parse(localStorage.getItem('aurum_ctx')||'{}');if(saved.id)id.value=saved.id;if(saved.name)nm.value=saved.name;if(saved.op)op.value=saved.op;
const q=new URLSearchParams(location.search);['id','name','op'].forEach(k=>{if(q.get(k)){if(k==='id')id.value=q.get(k);if(k==='name')nm.value=q.get(k);if(k==='op')op.value=q.get(k);}});
save();[id,nm,op].forEach(e=>e.addEventListener('input',save));function save(){localStorage.setItem('aurum_ctx',JSON.stringify({id:id.value.trim(),name:nm.value.trim(),op:op.value.trim()}));}
document.querySelector('#ctx-clear').addEventListener('click',()=>{localStorage.removeItem('aurum_ctx');id.value=nm.value=op.value='';});})();

/* ===== Numerología básica ===== */
const MAP = {A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,J:1,K:2,L:3,M:4,N:5,O:6,P:7,Q:8,R:9,S:1,T:2,U:3,V:4,W:5,X:6,Y:7,Z:8};
const VOW = new Set(['A','E','I','O','U','Y']);

function sumWord(str, onlyVowels=false, onlyConsonants=false){
  let s=0;
  for(const ch of str.normalize("NFD").replace(/[\u0300-\u036f]/g,'').toUpperCase()){
    if(!/[A-Z]/.test(ch)) continue;
    const isV = VOW.has(ch);
    if(onlyVowels && !isV) continue;
    if(onlyConsonants && isV) continue;
    s += MAP[ch]||0;
  }
  return s;
}
function reduce(n){ // mantiene maestros 11,22,33
  while(n>9 && n!==11 && n!==22 && n!==33){ n = (''+n).split('').reduce((a,b)=>a+ +b,0); }
  return n;
}
function lifePath(dmy){
  const m = dmy.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);
  if(!m) return null;
  const s = m[1].split('').concat(m[2].split(''),m[3].split('')).reduce((a,b)=>a+ +b,0);
  return reduce(s);
}
function personalYear(dmy, year=(new Date).getFullYear()){
  const m = dmy.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/); if(!m) return null;
  const s = [...m[1],...m[2],...(''+year)].reduce((a,b)=>a+ +b,0);
  return reduce(s);
}

document.querySelector('#calc').addEventListener('click', ()=>{
  const name = document.querySelector('#fullname').value.trim();
  const birth = document.querySelector('#birth').value.trim();
  if(!name || !birth){ alert('Ingresa nombre y fecha.'); return; }

  const expr = reduce(sumWord(name));
  const soul = reduce(sumWord(name, true, false));
  const pers = reduce(sumWord(name, false, true));
  const life = lifePath(birth);
  const year = personalYear(birth);

  document.querySelector('#k_expr').textContent=expr||'—';
  document.querySelector('#k_soul').textContent=soul||'—';
  document.querySelector('#k_pers').textContent=pers||'—';
  document.querySelector('#k_life').textContent=life||'—';
  document.querySelector('#k_year').textContent=year||'—';

  // tabla de segmentos
  const tbody = document.querySelector('#tbl tbody'); tbody.innerHTML='';
  name.split(/\s+/).filter(Boolean).forEach(seg=>{
    const s = sumWord(seg);
    const r = reduce(s);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${seg}</td><td>${seg}</td><td>${s}</td><td>${r}</td>`;
    tbody.appendChild(tr);
  });
});
</script>
</body>
</html>