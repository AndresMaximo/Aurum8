<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Recursos Humanos · AURUM∞</title>
<link rel="stylesheet" href="/aurum-theme.css">
<link rel="stylesheet" href="/common/topbar.css">
<style>
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .card{background:#0b0f12;border:1px solid #1e2b33;border-radius:16px;padding:16px;margin-bottom:16px}
  .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:10px;border-bottom:1px solid #1e2b33}
  .btn{background:#00f5d4;border:0;padding:10px 14px;border-radius:10px;color:#001313;cursor:pointer}
  .muted{opacity:.7}
  @media (max-width:720px){.row{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="topbar"></div>

<main class="wrap">
  <h1>Recursos Humanos</h1>
  <p class="muted">Estado de conexión: <b data-conn>—</b></p>

  <section class="card">
    <h2>Nuevo colaborador</h2>
    <form id="form-nuevo-trabajador" class="row">
      <input name="nombre" placeholder="Nombre" required/>
      <input name="rut" placeholder="RUT / ID"/>
      <input name="cargo" placeholder="Cargo"/>
      <button class="btn" style="grid-column:1/-1">Guardar</button>
    </form>
  </section>

  <section class="card">
    <h2>Listado</h2>
    <table id="tabla-trabajadores">
      <thead><tr><th>Nombre</th><th>RUT</th><th>Cargo</th><th>Acción</th></tr></thead>
      <tbody><tr><td colspan="4">—</td></tr></tbody>
    </table>
  </section>
</main>

<script>fetch('/common/topbar.html').then(r=>r.text()).then(t=>document.getElementById('topbar').innerHTML=t)</script>
<script type="module" src="/supabaseClient.js"></script>
<script type="module" src="/aurum-data.js"></script>
<script type="module">
  import { listarTrabajadores, crearTrabajador, pintarEstadoConexion } from "/aurum-data.js";
  pintarEstadoConexion();

  const tbody = document.querySelector("#tabla-trabajadores tbody");
  async function cargarTabla(){
    tbody.innerHTML = '<tr><td colspan="4">Cargando…</td></tr>';
    try{
      const lista = await listarTrabajadores();
      tbody.innerHTML = (lista.length? lista.map(t=>`
        <tr><td>${t.nombre??"-"}</td><td>${t.rut??"-"}</td><td>${t.cargo??"-"}</td><td>—</td></tr>
      `).join("") : '<tr><td colspan="4">Sin registros</td></tr>');
    }catch(e){ console.error(e); tbody.innerHTML = '<tr><td colspan="4">Error</td></tr>'; }
  }
  cargarTabla();

  document.getElementById("form-nuevo-trabajador").addEventListener("submit", async ev=>{
    ev.preventDefault();
    const fd = new FormData(ev.currentTarget);
    try{
      await crearTrabajador({ nombre:fd.get("nombre")?.trim()||null, rut:fd.get("rut")?.trim()||null, cargo:fd.get("cargo")?.trim()||null });
      ev.currentTarget.reset();
      await cargarTabla();
      alert("Trabajador creado");
    }catch(e){ console.error(e); alert("Error al crear"); }
  });
</script>
</body>
</html>