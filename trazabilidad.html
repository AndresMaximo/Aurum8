<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trazabilidad Energética • AURUM∞</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="lemuria.css" />
  <style>
    .card{background:var(--bg-card);border:1px solid var(--gold-20);border-radius:14px;padding:16px;box-shadow:var(--shadow)}
    .row{display:grid;gap:10px}
    @media(min-width:760px){.row{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
<header class="top">
  <h1>AURUM∞</h1>
  <nav>
    <a href="index.html">Inicio</a>
    <a href="vision.html">Visión</a>
    <a href="modulos.html">Módulos</a>
    <a href="contacto.html">Contacto</a>
  </nav>
</header>

<main class="container">
  <h2>Trazabilidad de Activo / Intervención</h2>

  <section class="card">
    <div class="row">
      <div>
        <label>ID Activo (QR / código)</label>
        <input id="id" placeholder="HILUX-A8-001" />
      </div>
      <div>
        <label>Nombre / Descripción</label>
        <input id="desc" placeholder="Toyota Hilux – Check 50 pts / Intervención" />
      </div>
      <div>
        <label>Estado</label>
        <select id="estado">
          <option>Pendiente</option><option>En proceso</option><option>Terminado</option>
        </select>
      </div>
      <div>
        <label>Ubicación (GPS)</label>
        <div style="display:flex; gap:8px">
          <button id="gps" class="btn">Obtener ubicación</button>
          <input id="lat" placeholder="Lat" />
          <input id="lng" placeholder="Lng" />
        </div>
      </div>
      <div class="row" style="grid-column:1/-1">
        <label>Evidencia (imágenes, PDFs)</label>
        <input id="files" type="file" multiple />
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
      <button id="save" class="btn gold">Guardar local</button>
      <button id="load" class="btn">Cargar</button>
      <button id="clear" class="btn">Borrar</button>
      <button id="csv" class="btn gold">Exportar CSV</button>
    </div>
    <p class="muted" style="margin-top:8px">El guardado es local (navegador). Se conectará a backend más adelante.</p>
  </section>
</main>

<footer class="footer">© 2025 AURUM∞</footer>

<script>
 const KEY='aurum_trz';
 const $=s=>document.querySelector(s);
 const read=()=>({
    id:$('#id').value, desc:$('#desc').value, estado:$('#estado').value,
    lat:$('#lat').value, lng:$('#lng').value, ts:new Date().toISOString()
  });
 const apply=d=>{ if(!d) return; $('#id').value=d.id||''; $('#desc').value=d.desc||''; $('#estado').value=d.estado||'Pendiente'; $('#lat').value=d.lat||''; $('#lng').value=d.lng||''; };

 $('#gps').onclick=()=>navigator.geolocation && navigator.geolocation.getCurrentPosition(p=>{ $('#lat').value=p.coords.latitude.toFixed(6); $('#lng').value=p.coords.longitude.toFixed(6); });

 $('#save').onclick=()=>{ localStorage.setItem(KEY, JSON.stringify(read())); alert('Guardado.'); };
 $('#load').onclick=()=>apply(JSON.parse(localStorage.getItem(KEY)||'null'));
 $('#clear').onclick=()=>{ if(confirm('¿Borrar tarjeta local?')){ localStorage.removeItem(KEY); location.reload(); } };
 $('#csv').onclick=()=>{
   const d=read();
   const esc=v=>`"${(v||'').toString().replace(/"/g,'""')}"`;
   const head=['ID','Descripción','Estado','Lat','Lng','Fecha'];
   const row=[d.id,d.desc,d.estado,d.lat,d.lng,d.ts].map(esc).join(',');
   const blob=new Blob([[head.join(','),row].join('\n')],{type:'text/csv;charset=utf-8;'});
   const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=(d.id||'trazabilidad')+'.csv'; a.click(); URL.revokeObjectURL(a.href);
 };

 apply(JSON.parse(localStorage.getItem(KEY)||'null'));
</script>
</body>
</html>