<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Numerología Integral</title>
<link rel="stylesheet" href="/common/topbar.css">
<style>
  body{margin:0;font-family:Orbitron,sans-serif;background:#000;color:#d8f3dc}
  main{max-width:1100px;margin:24px auto;padding:0 20px}
  .panel{border:1px solid rgba(120,255,255,.2);border-radius:14px;padding:16px;background:rgba(255,255,255,.03);margin-bottom:16px}
  label{display:block;margin:8px 0 4px}
  input{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(120,255,255,.25);background:#020b0b;color:#d8f3dc}
  button{margin-top:10px;padding:10px 14px;border-radius:10px;border:1px solid rgba(120,255,255,.3);background:#00f5d4;color:#001219;font-weight:700;cursor:pointer}
  h3{color:#aefcff}.res{white-space:pre-wrap}
  .muted{color:#8aa}
</style>
</head>
<body>
<div id="topbar"></div>

<main>
  <h2>Numerología Integral</h2>
  <div class="panel">
    <label>Nombre completo</label><input id="nombre" placeholder="Ej: Ignacio Andrés Salazar Escobar">
    <label>Fecha de nacimiento</label><input id="fecha" type="date">
    <button id="btn-analizar">Analizar</button>
    <button id="btn-guardar" class="ghost">Guardar informe</button>
    <div id="msg" class="muted"></div>
  </div>

  <div class="panel">
    <h3>Resultado</h3>
    <div id="out" class="res">Ingresa tus datos y presiona Analizar.</div>
  </div>
</main>

<script>
  fetch('/common/topbar.html').then(r=>r.text()).then(h=>document.getElementById('topbar').innerHTML=h)
</script>

<script type="module">
  import { supabase } from '/common/supabaseClient.js';
  const $ = (id)=>document.getElementById(id);

  function interpretar(nombre, fechaISO){
/* —— Placeholder de interpretación simbólica ——
   Aquí puedes enriquecer con tus textos largos por sección (pitagórica, tántrica, luna natal y fases).
*/
const d = new Date(fechaISO);
const dias = ["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"];
const tono = ["Reposo consciente","Orden suave","Comunicación clara","Estructura y foco","Creatividad aplicada","Servicio y cooperación","Introspección y ajuste"][d.getDay()];
return `Nombre: ${nombre}
Nacimiento: ${fechaISO} · ${dias[d.getDay()]}

Pitagórica · Tu enfoque natural es construir con propósito y coherencia práctica.
Tántrica · Tu energía crece cuando sirves y armonizas mente-emoción-acción.
Luna Natal/Fases · Mantén rutinas simples; en días de alta energía lunar, canaliza a tareas finas y seguras.

Mensaje emocional del día · ${tono}
Recomendación · Respira, simplifica y prioriza seguridad. Escucha señales del cuerpo.`;
  }

  $('btn-analizar').addEventListener('click', ()=>{
    const nombre = $('nombre').value.trim();
    const fecha = $('fecha').value;
    if(!nombre || !fecha){ $('msg').textContent = 'Completa nombre y fecha.'; return; }
    $('msg').textContent = '';
    $('out').textContent = interpretar(nombre, fecha);
  });

  $('btn-guardar').addEventListener('click', async ()=>{
    const nombre = $('nombre').value.trim();
    const fecha = $('fecha').value;
    const informe = $('out').textContent.trim();
    if(!nombre || !fecha || !informe){ $('msg').textContent = 'Analiza primero para guardar.'; return; }
    const { error } = await supabase.from('diagnosticos_numerologia').insert([{ nombre, fecha_nac: fecha, informe }]);
    $('msg').textContent = error ? ('Error: '+error.message) : 'Informe guardado.';
  });
</script>
</body>
</html>