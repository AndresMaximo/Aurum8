<nav class="topbar">
  <a class="brand" href="/index.html">AURUM∞</a>

  <button class="burger" aria-label="menu">
    <span></span><span></span><span></span>
  </button>

  <ul class="menu">
    <li><a href="/index.html">Inicio</a></li>
    <li><a href="/vision.html">Visión</a></li>
    <li><a href="/modulos.html">Módulos</a></li>
    <li class="divider"></li>
    <li><a href="/modulos/ot/index.html">Órdenes de Trabajo</a></li>
    <li><a href="/modulos/recursos-humanos/index.html">Recursos Humanos</a></li>
    <li><a href="/modulos/bodega/index.html">Bodega</a></li>
    <li id="link-admin" style="display:none">
      <a href="/modulos/admin-usuarios/index.html">Admin Usuarios</a>
    </li>
    <li class="divider"></li>
    <li><a href="/contacto.html">Contacto</a></li>

    <!-- derecha -->
    <li class="right">
      <span id="user-pill" class="pill" style="display:none">—</span>
      <a id="auth-link" href="/login.html">Login</a>
    </li>
  </ul>
</nav>

<style>
  .topbar{position:sticky;top:0;z-index:50;display:flex;align-items:center;gap:14px;
    padding:10px 16px;background:#020607;border-bottom:1px solid #13312b}
  .brand{color:#00f5d4;text-decoration:none;font-weight:800;letter-spacing:.5px}
  .menu{list-style:none;margin:0;padding:0;display:flex;flex-wrap:wrap;gap:10px;align-items:center;width:100%}
  .menu a{display:block;padding:8px 10px;border-radius:10px;text-decoration:none;
    color:#b7efe4;border:1px solid transparent;white-space:nowrap}
  .menu a:hover{border-color:#1f4a42;background:#081513}
  .menu .right{margin-left:auto;display:flex;align-items:center;gap:10px}
  .menu .divider{width:1px;height:22px;background:#173730;opacity:.5}
  .pill{padding:6px 10px;border-radius:999px;border:1px solid #1f4a42;background:#061312;color:#9eeadf;font-size:.86rem}
  .burger{display:none;margin-left:auto;border:0;background:transparent;width:36px;height:32px;cursor:pointer}
  .burger span{display:block;height:2px;background:#b7efe4;margin:6px 4px}
  @media (max-width:820px){
    .burger{display:block}
    .menu{display:none;flex-direction:column;align-items:stretch}
    .menu.show{display:flex}
    .menu .right{margin-left:0}
    .menu .divider{display:none}
  }
</style>

<script type="module">
  import { supabase } from '/js/supabaseClient.js';

  // elementos
  const nav  = document.currentScript.previousElementSibling.previousElementSibling.previousElementSibling;
  const burger = nav.querySelector('.burger');
  const menu = nav.querySelector('.menu');
  const linkAdmin = nav.querySelector('#link-admin');
  const authLink  = nav.querySelector('#auth-link');
  const userPill  = nav.querySelector('#user-pill');

  // burger móvil
  burger.addEventListener('click', ()=> menu.classList.toggle('show'));

  // pinta UI según sesión
  async function refreshAuthUI(){
    const { data: u } = await supabase.auth.getUser();
    if (!u?.user){
      authLink.textContent = 'Login';
      authLink.href = '/login.html';
      userPill.style.display = 'none';
      linkAdmin.style.display = 'none';
      return;
    }

    // trae perfil (rol/nombre)
    const { data: perfil } = await supabase
      .from('perfiles')
      .select('role, full_name, email')
      .eq('id', u.user.id)
      .maybeSingle();

    const rol = perfil?.role || 'viewer';
    const nombre = perfil?.full_name || perfil?.email || u.user.email;

    userPill.textContent = `${nombre} · ${rol}`;
    userPill.style.display = 'inline-block';

    authLink.textContent = 'Salir';
    authLink.href = '#';

    // muestra Admin si es admin
    linkAdmin.style.display = rol === 'admin' ? 'list-item' : 'none';
  }

  await refreshAuthUI();

  // logout
  authLink.addEventListener('click', async (e)=>{
    if (authLink.textContent === 'Salir'){
      e.preventDefault();
      await supabase.auth.signOut();
      location.href = '/login.html';
    }
  });

  // si cambia la sesión desde otra pestaña
  supabase.auth.onAuthStateChange((_event, _session)=> refreshAuthUI());
</script>