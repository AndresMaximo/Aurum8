<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AURUM∞ · Órdenes de Trabajo</title>
<link rel="stylesheet" href="style.css">
<style>
  /* —— Estética Lemuriana / Oscuro cristalino —— */
  :root{
    --bg:#0a0f16; --panel:#101827; --ink:#e6f0ff; --muted:#9fb0c9;
    --acc1:#7bd6ff; --acc2:#a48bff; --acc3:#08ffc6; --danger:#ff6b6b; --ok:#3bd671;
  }
  body{background:radial-gradient(1200px 800px at 20% -10%, #16213544, transparent),
                 radial-gradient(1000px 700px at 120% 10%, #1b103844, transparent),
                 var(--bg); color:var(--ink); margin:0; font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif;}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;border-bottom:1px solid #223047;background:#0b121d99;backdrop-filter:blur(6px);position:sticky;top:0;z-index:50}
  header h1{margin:0;font-size:20px;letter-spacing:.08em}
  nav ul{list-style:none;display:flex;gap:14px;margin:0;padding:0}
  nav a{color:var(--muted);text-decoration:none;padding:6px 10px;border-radius:8px}
  nav a:hover, nav a.active{color:var(--ink);background:#ffffff0f}

  main{max-width:1100px;margin:24px auto;padding:0 16px}
  h2{letter-spacing:.08em;margin:10px 0 16px}
  .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin:14px 0 18px}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .btn{background:linear-gradient(135deg, #23304a, #1a2440);border:1px solid #2a3a59;color:var(--ink);
       padding:9px 12px;border-radius:10px;cursor:pointer}
  .btn:hover{box-shadow:0 0 0 2px #ffffff10 inset, 0 0 18px #7bd6ff20}
  .btn.acc{border-color:#345b7a; background:linear-gradient(135deg,#173048,#0e213a); color:#cfeaff}
  .btn.ok{border-color:#245c47;background:linear-gradient(135deg,#103b2f,#0f2e28);color:#d9ffe8}
  .btn.bad{border-color:#6b2b2b;background:linear-gradient(135deg,#3a1414,#2a0e0e);color:#ffdede}

  .panel{background:linear-gradient(180deg, #0f1624 0%, #0d1320 100%); border:1px solid #223047; border-radius:14px; padding:14px}
  .grid{display:grid; grid-template-columns:1fr 1fr; gap:14px}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} }

  /* Formulario */
  form .two{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  form .three{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  input, select, textarea{
    width:100%; background:#0b1220; border:1px solid #26334e; color:var(--ink);
    padding:10px 12px; border-radius:10px; outline:none
  }
  input:focus, select:focus, textarea:focus{border-color:#39507a; box-shadow:0 0 0 3px #7bd6ff22}
  label{font-size:12px; color:var(--muted); display:block; margin:6px 0}
  textarea{min-height:96px; resize:vertical}

  /* Tabla / Lista */
  .table{width:100%; border-collapse:collapse; margin-top:8px}
  .table th,.table td{padding:10px 10px; border-bottom:1px solid #1f2a41; text-align:left; font-size:14px}
  .table th{color:#cfe0ff; font-weight:600; letter-spacing:.04em}
  .status{padding:3px 8px; border-radius:999px; font-size:12px; border:1px solid #28405f; display:inline-block}
  .status.abierta{border-color:#3b5d8f; color:#bfe1ff}
  .status.proceso{border-color:#7a5df0; color:#e1d7ff}
  .status.cerrada{border-color:#2f6b4f; color:#ccffe6}
  .tag{font-size:12px;color:#a6c8ff;background:#22324a;border:1px solid #2b4771;padding:2px 6px;border-radius:8px}

  .filters .row > *{min-width:160px}
  .right{margin-left:auto}

  .empty{color:var(--muted);text-align:center;padding:26px}
  .muted{color:var(--muted)}
  .badge{background:linear-gradient(135deg,#1c2845,#232a55);border:1px solid #39507a;color:#cfe0ff;padding:2px 8px;border-radius:999px;font-size:12px}

  /* Print */
  @media print{
    header, .toolbar, .filters, .form-wrap, .actions{display:none !important}
    body{background:white;color:black}
    .panel{border:0}
    .table th,.table td{border-color:#ddd;color:black}
  }
</style>
</head>
<body>
<header>
  <h1>AURUM∞</h1>
  <nav>
    <ul>
      <li><a href="index.html">Inicio</a></li>
      <li><a href="vision.html">Visión</a></li>
      <li><a href="modulos.html">Módulos</a></li>
      <li><a href="contacto.html">Contacto</a></li>
    </ul>
  </nav>
</header>

<main>
  <h2>Órdenes de Trabajo <span class="badge" id="countBadge">0</span></h2>

  <!-- Herramientas -->
  <div class="toolbar">
    <div class="row">
      <button class="btn acc" id="newBtn">+ Nueva OT</button>
      <button class="btn" id="exportBtn">Exportar CSV</button>
      <button class="btn" id="printBtn">Imprimir</button>
    </div>
    <div class="row">
      <input id="q" type="search" placeholder="Buscar por título / equipo / solicitante…" />
    </div>
  </div>

  <!-- Filtros -->
  <div class="panel filters" style="margin-bottom:14px">
    <div class="row">
      <div>
        <label>Estado</label>
        <select id="fEstado">
          <option value="">Todos</option>
          <option value="Abierta">Abierta</option>
          <option value="En Proceso">En Proceso</option>
          <option value="Cerrada">Cerrada</option>
        </select>
      </div>
      <div>
        <label>Prioridad</label>
        <select id="fPrioridad">
          <option value="">Todas</option>
          <option value="Alta">Alta</option>
          <option value="Media">Media</option>
          <option value="Baja">Baja</option>
        </select>
      </div>
      <div>
        <label>Equipo</label>
        <input id="fEquipo" placeholder="Hilux / Feeder / Bomba …">
      </div>
      <div class="right">
        <label>&nbsp;</label>
        <button class="btn" id="clearFilters">Limpiar filtros</button>
      </div>
    </div>
  </div>

  <!-- Formulario -->
  <div class="panel form-wrap" id="formWrap" style="display:none">
    <form id="otForm">
      <input type="hidden" id="otId">
      <div class="three">
        <div>
          <label>Título</label>
          <input id="titulo" required placeholder="Ej: Mantención preventiva – Hilux"/>
        </div>
        <div>
          <label>Equipo</label>
          <input id="equipo" required placeholder="Hilux / Feeder / Bomba…"/>
        </div>
        <div>
          <label>Prioridad</label>
          <select id="prioridad" required>
            <option value="Media">Media</option>
            <option value="Alta">Alta</option>
            <option value="Baja">Baja</option>
          </select>
        </div>
      </div>

      <div class="three">
        <div>
          <label>Estado</label>
          <select id="estado">
            <option>Abierta</option>
            <option>En Proceso</option>
            <option>Cerrada</option>
          </select>
        </div>
        <div>
          <label>Solicitante</label>
          <input id="solicitante" placeholder="Nombre quien solicita"/>
        </div>
        <div>
          <label>Responsable</label>
          <input id="responsable" placeholder="Técnico / Supervisor asignado"/>
        </div>
      </div>

      <div class="two">
        <div>
          <label>Fecha programada</label>
          <input type="date" id="fecha"/>
        </div>
        <div>
          <label>Ubicación</label>
          <input id="ubicacion" placeholder="Planta / Faena / Área"/>
        </div>
      </div>

      <div>
        <label>Descripción</label>
        <textarea id="descripcion" placeholder="Trabajo a realizar, insumos, riesgos, bloqueo, EPP…"></textarea>
      </div>

      <div class="row actions" style="margin-top:10px">
        <button class="btn ok" type="submit" id="saveBtn">Guardar OT</button>
        <button class="btn" type="button" id="cancelBtn">Cancelar</button>
      </div>
    </form>
  </div>

  <!-- Lista -->
  <div class="panel">
    <table class="table" id="list">
      <thead>
        <tr>
          <th>ID</th>
          <th>Título</th>
          <th>Equipo</th>
          <th>Prioridad</th>
          <th>Estado</th>
          <th>Fecha</th>
          <th>Responsable</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="8" class="empty">Sin registros aún.</td></tr>
      </tbody>
    </table>
  </div>
</main>

<footer>
  <p class="muted" style="text-align:center;padding:16px 10px">&copy; 2025 AURUM∞</p>
</footer>

<script>
/* --------------------- Estado / Datos --------------------- */
const key = "aurum_ot";
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const store = {
  all(){ try{ return JSON.parse(localStorage.getItem(key))||[] }catch{ return [] } },
  save(list){ localStorage.setItem(key, JSON.stringify(list)) }
};
let data = store.all();
let editingId = null;

/* --------------------- Utilidades --------------------- */
const uid = () => Math.floor(Date.now()/1000) + "-" + Math.random().toString(36).slice(2,7);
const fmt = d => d ? new Date(d+"T00:00:00").toLocaleDateString() : "";
const byId = id => data.find(x=>x.id===id);

/* --------------------- Render --------------------- */
function render(){
  const q = $("#q").value.trim().toLowerCase();
  const fe = $("#fEstado").value;
  const fp = $("#fPrioridad").value;
  const fq = $("#fEquipo").value.trim().toLowerCase();

  let rows = data.filter(r=>{
    let pass = true;
    if (fe && r.estado!==fe) pass=false;
    if (fp && r.prioridad!==fp) pass=false;
    if (fq && !r.equipo.toLowerCase().includes(fq)) pass=false;
    if (q){
      const blob = `${r.titulo} ${r.equipo} ${r.solicitante} ${r.responsable}`.toLowerCase();
      if (!blob.includes(q)) pass=false;
    }
    return pass;
  });

  $("#countBadge").textContent = rows.length;
  const tb = $("#tbody");
  tb.innerHTML = "";

  if (!rows.length){
    tb.innerHTML = `<tr><td colspan="8" class="empty">No hay resultados con los filtros actuales.</td></tr>`;
    return;
  }

  for (const r of rows){
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><span class="muted">${r.id.split("-")[0]}</span></td>
      <td>${escapeHtml(r.titulo)}</td>
      <td><span class="tag">${escapeHtml(r.equipo)}</span></td>
      <td>${r.prioridad}</td>
      <td>${statusPill(r.estado)}</td>
      <td>${fmt(r.fecha)}</td>
      <td>${escapeHtml(r.responsable||"")}</td>
      <td style="white-space:nowrap">
        <button class="btn" data-edit="${r.id}" title="Editar">Editar</button>
        ${r.estado!=="Cerrada"
          ? `<button class="btn ok" data-close="${r.id}" title="Cerrar">Cerrar</button>`
          : `<button class="btn acc" data-reopen="${r.id}" title="Reabrir">Reabrir</button>`
        }
        <button class="btn bad" data-del="${r.id}" title="Eliminar">✕</button>
      </td>
    `;
    tb.appendChild(tr);
  }
}
function statusPill(s){
  const cls = s==="Abierta"?"abierta":(s==="En Proceso"?"proceso":"cerrada");
  return `<span class="status ${cls}">${s}</span>`;
}
function escapeHtml(s=""){ return s.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])) }

/* --------------------- Formulario --------------------- */
function openForm(record=null){
  $("#formWrap").style.display = "block";
  if (record){
    editingId = record.id;
    $("#otId").value = record.id;
    $("#titulo").value = record.titulo||"";
    $("#equipo").value = record.equipo||"";
    $("#prioridad").value = record.prioridad||"Media";
    $("#estado").value = record.estado||"Abierta";
    $("#solicitante").value = record.solicitante||"";
    $("#responsable").value = record.responsable||"";
    $("#fecha").value = record.fecha||"";
    $("#ubicacion").value = record.ubicacion||"";
    $("#descripcion").value = record.descripcion||"";
    $("#saveBtn").textContent = "Guardar cambios";
  }else{
    editingId = null;
    $("#otId").value = "";
    $("#titulo").value = "";
    $("#equipo").value = "";
    $("#prioridad").value = "Media";
    $("#estado").value = "Abierta";
    $("#solicitante").value = "";
    $("#responsable").value = "";
    $("#fecha").value = "";
    $("#ubicacion").value = "";
    $("#descripcion").value = "";
    $("#saveBtn").textContent = "Crear OT";
  }
  window.scrollTo({top:0,behavior:"smooth"});
}
function closeForm(){ $("#formWrap").style.display = "none"; }

$("#newBtn").onclick = ()=> openForm();
$("#cancelBtn").onclick = ()=> closeForm();

$("#otForm").addEventListener("submit", e=>{
  e.preventDefault();
  const rec = {
    id: editingId || uid(),
    titulo: $("#titulo").value.trim(),
    equipo: $("#equipo").value.trim(),
    prioridad: $("#prioridad").value,
    estado: $("#estado").value,
    solicitante: $("#solicitante").value.trim(),
    responsable: $("#responsable").value.trim(),
    fecha: $("#fecha").value,
    ubicacion: $("#ubicacion").value.trim(),
    descripcion: $("#descripcion").value.trim(),
    updatedAt: Date.now()
  };
  if (!rec.titulo || !rec.equipo){ alert("Título y Equipo son obligatorios."); return; }

  if (editingId){
    data = data.map(x=> x.id===editingId ? rec : x);
  }else{
    data.unshift(rec);
  }
  store.save(data);
  closeForm();
  render();
});

/* --------------------- Acciones en lista --------------------- */
$("#tbody").addEventListener("click", e=>{
  const t = e.target;
  if (t.dataset.edit){ const r = byId(t.dataset.edit); if(r) openForm(r); }
  if (t.dataset.del){
    const id = t.dataset.del;
    if (confirm("¿Eliminar esta OT?")){ data = data.filter(x=>x.id!==id); store.save(data); render(); }
  }
  if (t.dataset.close){
    const r = byId(t.dataset.close); if(!r) return;
    r.estado = "Cerrada"; r.updatedAt = Date.now(); store.save(data); render();
  }
  if (t.dataset.reopen){
    const r = byId(t.dataset.reopen); if(!r) return;
    r.estado = "Abierta"; r.updatedAt = Date.now(); store.save(data); render();
  }
});

/* --------------------- Filtros / Búsqueda --------------------- */
$("#q").oninput = render;
$("#fEstado").onchange = render;
$("#fPrioridad").onchange = render;
$("#fEquipo").oninput = render;
$("#clearFilters").onclick = ()=>{
  $("#q").value=""; $("#fEstado").value=""; $("#fPrioridad").value=""; $("#fEquipo").value="";
  render();
};

/* --------------------- Export / Print --------------------- */
$("#exportBtn").onclick = ()=>{
  const header = ["id","titulo","equipo","prioridad","estado","fecha","solicitante","responsable","ubicacion","descripcion"];
  const rows = [header.join(",")];
  for (const r of data){
    const line = header.map(k => `"${String(r[k]??"").replace(/"/g,'""')}"`).join(",");
    rows.push(line);
  }
  const blob = new Blob([rows.join("\n")], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "aurum-ot.csv"; a.click();
  URL.revokeObjectURL(url);
};
$("#printBtn").onclick = ()=> window.print();

/* --------------------- Seed opcional (primera vez) --------------------- */
if (!data.length){
  data = [
    { id: uid(), titulo:"Mantención preventiva – Hilux", equipo:"Hilux", prioridad:"Media", estado:"Abierta", solicitante:"Claudio", responsable:"Técnico A", fecha:new Date().toISOString().slice(0,10), ubicacion:"Patio Taller", descripcion:"Checklist de 50 puntos + cambio filtro aceite.", updatedAt:Date.now() },
    { id: uid(), titulo:"Inspección buzón FE043", equipo:"Feeder", prioridad:"Alta", estado:"En Proceso", solicitante:"Operaciones", responsable:"Mecánico B", fecha:"", ubicacion:"Traspaso CT236", descripcion:"Revisión lifters y placas guía (según protocolo).", updatedAt:Date.now() }
  ];
  store.save(data);
}
render();
</script>
</body>
</html>