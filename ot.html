<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AURUM∞ · Órdenes de Trabajo</title>
<style>
:root{
  --bg1:#0a0f1a; --bg2:#121a2b; --iris:#8ad9ff; --aqua:#39f1c5; --gold:#ffe083;
  --violet:#b99cff; --rose:#ff9ad6; --text:#ecf3ff; --muted:#9fb0c9;
  --card:#0f1524cc; --card2:#0d1220e6; --ok:#38d39f; --warn:#ffd36b; --danger:#ff7b7b;
}
body{margin:0;color:var(--text);background:radial-gradient(1200px 800px at 20% 10%,#1b2847 0%,var(--bg2) 40%,var(--bg1) 85%);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
.stars,.nebula{position:fixed;inset:0;pointer-events:none;z-index:-1}
.stars{background-image:radial-gradient(2px 2px at 10% 20%,#ffffff66 30%,transparent 31%),radial-gradient(1.5px 1.5px at 70% 30%,#ffffff55 30%,transparent 31%),radial-gradient(1.5px 1.5px at 30% 70%,#ffffff55 30%,transparent 31%),radial-gradient(1px 1px at 80% 80%,#ffffff33 30%,transparent 31%)}
.nebula{background:radial-gradient(600px 400px at 75% 20%,#7ef7ff12,transparent 60%),radial-gradient(500px 350px at 20% 80%,#a47bff14,transparent 60%),radial-gradient(350px 250px at 50% 50%,#ffb3e614,transparent 60%)}
header{position:sticky;top:0;z-index:5;backdrop-filter:blur(8px);background:linear-gradient(180deg,#0b1020ee,#0b1020cc 60%,transparent);border-bottom:1px solid #ffffff12}
.container{max-width:1200px;margin:0 auto;padding:20px 16px}
.brand{display:flex;align-items:center;gap:12px}
.brand .sigil{width:40px;height:40px;border-radius:50%;background:conic-gradient(from 220deg,var(--aqua),var(--violet),var(--rose),var(--aqua));box-shadow:0 0 20px #8ad9ff55,inset 0 0 18px #ffffff22;display:grid;place-items:center;color:#001923;font-weight:800}
.brand h1{font-size:20px;margin:0;letter-spacing:.08em}
nav a{color:var(--muted);text-decoration:none;margin-right:16px}
nav a:hover{color:var(--aqua)}
.grid{display:grid;gap:18px;grid-template-columns:1fr}
@media(min-width:1000px){.grid{grid-template-columns:1.1fr 1fr}}
.card{background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid #ffffff1a;border-radius:16px;padding:18px;box-shadow:0 10px 30px #0008,inset 0 1px 0 #fff1}
h2{margin:0 0 10px 0;font-size:20px;letter-spacing:.06em}
.sub{color:var(--muted);font-size:13px;margin-bottom:12px}
label{font-size:13px;color:var(--muted)}
.row{display:grid;gap:12px;grid-template-columns:1fr}
@media(min-width:700px){.row{grid-template-columns:repeat(3,1fr)}}
input,select,textarea,button{width:100%;padding:12px;border-radius:12px;border:1px solid #ffffff22;background:#0d1322;color:var(--text);outline:none}
textarea{min-height:90px;resize:vertical}
input:focus,select:focus,textarea:focus{border-color:#7ef7ff55;box-shadow:0 0 0 3px #39f1c51f}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.btn{cursor:pointer;border:1px solid #39f1c544;background:linear-gradient(180deg,#1a2742,#121b34)}
.btn.primary{border-color:#39f1c588;background:linear-gradient(180deg,#1b3344,#10263b)}
.btn.gold{border-color:#ffd36b66;background:linear-gradient(180deg,#3a2b14,#231b0d)}
.btn.red{border-color:#ff7b7b66;background:linear-gradient(180deg,#402020,#2b1212)}
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table th,.table td{border-bottom:1px solid #ffffff14;padding:10px 8px;font-size:14px;text-align:left}
.badge{display:inline-block;padding:2px 10px;border-radius:999px;font-size:12px;border:1px solid #ffffff22;color:#cfe9ff}
.b-ok{border-color:#38d39f66;color:#bff3e1}
.b-warn{border-color:#ffd36b66;color:#ffe9b8}
.b-danger{border-color:#ff7b7b66;color:#ffc9c9}
.kv{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.pill{border:1px solid #ffffff1f;border-radius:12px;padding:10px;background:#0b1222}
footer.note{color:#94a7c5;font-size:12px;margin-top:10px}
@media print{header,.no-print{display:none}body{background:#fff;color:#111}.card{box-shadow:none;border:1px solid #ccc;background:#fff}.stars,.nebula{display:none}}
</style>
</head>
<body>
<div class="stars"></div><div class="nebula"></div>
<header>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:16px">
    <div class="brand"><div class="sigil">∞</div><h1>AURUM∞ · Órdenes de Trabajo</h1></div>
    <nav>
      <a href="/index.html">Inicio</a>
      <a href="/modulos.html">Módulos</a>
      <a href="/numerologia.html">Numerología</a>
      <a href="/contacto.html">Contacto</a>
    </nav>
  </div>
</header>

<main class="container grid">
  <!-- Formulario -->
  <section class="card">
    <h2>Nueva / Editar OT</h2>
    <div class="sub">Completa los datos y guarda. Se almacena localmente (sin servidor) y puedes exportar CSV o imprimir PDF.</div>
    <input type="hidden" id="otId"/>
    <div class="row">
      <div>
        <label>Código OT</label>
        <input id="codigo" placeholder="Ej: OT-2025-001"/>
      </div>
      <div>
        <label>Fecha</label>
        <input id="fecha" type="date"/>
      </div>
      <div>
        <label>Solicitante</label>
        <input id="solicitante" placeholder="Nombre quien solicita"/>
      </div>
    </div>
    <div class="row">
      <div>
        <label>Equipo</label>
        <input id="equipo" placeholder="Ej: Toyota Hilux / Chancador CH440 / Bomba SRH"/>
      </div>
      <div>
        <label>Ubicación</label>
        <input id="ubicacion" placeholder="Planta / Frente / Faja..."/>
      </div>
      <div>
        <label>Prioridad</label>
        <select id="prioridad">
          <option value="Alta">Alta</option>
          <option value="Media" selected>Media</option>
          <option value="Baja">Baja</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div style="grid-column:1/-1">
        <label>Descripción / Síntoma</label>
        <textarea id="descripcion" placeholder="Describe el problema, condición o requerimiento"></textarea>
      </div>
    </div>
    <div class="row">
      <div>
        <label>Estado</label>
        <select id="estado">
          <option value="Abierta" selected>Abierta</option>
          <option value="En Ejecución">En Ejecución</option>
          <option value="En Espera">En Espera</option>
          <option value="Cerrada">Cerrada</option>
        </select>
      </div>
      <div>
        <label>Responsable</label>
        <input id="responsable" placeholder="Técnico / Cuadrilla"/>
      </div>
      <div>
        <label>Fecha Cierre (si aplica)</label>
        <input id="fechaCierre" type="date"/>
      </div>
    </div>
    <div class="row">
      <div style="grid-column:1/-1">
        <label>Trabajo realizado / Observaciones</label>
        <textarea id="observaciones" placeholder="Se detalla lo ejecutado, repuestos, tiempos, pruebas..."></textarea>
      </div>
    </div>
    <div class="actions no-print">
      <button class="btn primary" onclick="guardarOT()">Guardar</button>
      <button class="btn" onclick="limpiarFormulario()">Limpiar</button>
      <button class="btn gold" onclick="imprimirOT()">Imprimir / PDF</button>
    </div>
    <footer class="note">Sugerencia: usa un formato consistente de <b>Código OT</b> (p.ej. OT-YYYY-###) para facilitar búsquedas.</footer>
  </section>

  <!-- Lista / Filtros -->
  <section class="card">
    <h2>Órdenes de Trabajo</h2>
    <div class="sub">Buscar y filtrar. Toca una fila para cargarla en el formulario y editarla.</div>
    <div class="row">
      <div><label>Buscar</label><input id="q" placeholder="Código, equipo, solicitante..." oninput="renderTabla()"/></div>
      <div>
        <label>Estado</label>
        <select id="fEstado" onchange="renderTabla()">
          <option value="">Todos</option>
          <option>Abierta</option><option>En Ejecución</option><option>En Espera</option><option>Cerrada</option>
        </select>
      </div>
      <div>
        <label>Prioridad</label>
        <select id="fPrioridad" onchange="renderTabla()">
          <option value="">Todas</option><option>Alta</option><option selected>Media</option><option>Baja</option>
        </select>
      </div>
    </div>
    <div style="overflow:auto;max-height:480px;margin-top:8px;border:1px solid #ffffff14;border-radius:12px">
      <table class="table" id="tablaOT">
        <thead>
          <tr>
            <th>Código</th><th>Fecha</th><th>Equipo</th><th>Solicitante</th><th>Prioridad</th><th>Estado</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="actions no-print">
      <button class="btn" onclick="exportCSV()">Exportar CSV</button>
      <button class="btn red" onclick="eliminarSeleccionada()">Eliminar seleccionada</button>
      <button class="btn" onclick="marcarCerrada()">Marcar como Cerrada</button>
    </div>

    <!-- Vista rápida -->
    <div id="detalle" style="margin-top:10px;display:none">
      <h3 style="margin:10px 0 6px 0">Detalle</h3>
      <div class="kv">
        <div class="pill"><b>Código:</b> <span id="dCod"></span></div>
        <div class="pill"><b>Fecha:</b> <span id="dFec"></span></div>
        <div class="pill"><b>Equipo:</b> <span id="dEq"></span></div>
        <div class="pill"><b>Ubicación:</b> <span id="dUb"></span></div>
        <div class="pill"><b>Prioridad:</b> <span id="dPri"></span></div>
        <div class="pill"><b>Estado:</b> <span id="dEst"></span></div>
        <div class="pill"><b>Responsable:</b> <span id="dResp"></span></div>
        <div class="pill"><b>Fecha Cierre:</b> <span id="dCie"></span></div>
      </div>
      <div class="pill" style="margin-top:8px"><b>Descripción:</b><br><span id="dDesc"></span></div>
      <div class="pill" style="margin-top:8px"><b>Trabajo realizado / Observaciones:</b><br><span id="dObs"></span></div>
    </div>
  </section>
</main>

<script>
/* Storage */
const KEY='AURUM_OT';
let data = JSON.parse(localStorage.getItem(KEY) || '[]');
let selectedId = null;

/* Helpers */
const byId = id => document.getElementById(id);
function hoyISO(){ const d=new Date(); return d.toISOString().slice(0,10); }
function badgeEstado(e){
  const cls = e==='Cerrada' ? 'b-ok' : (e==='En Espera'?'b-warn': (e==='En Ejecución'?'':'b-danger'));
  return `<span class="badge ${cls}">${e}</span>`;
}
function badgePri(p){
  const cls = p==='Alta'?'b-danger':(p==='Baja'?'b-ok':'b-warn');
  return `<span class="badge ${cls}">${p}</span>`;
}

/* Form ops */
function limpiarFormulario(){
  selectedId=null; byId('otId').value='';
  ['codigo','fecha','solicitante','equipo','ubicacion','descripcion','responsable','observaciones','fechaCierre'].forEach(id=>byId(id).value='');
  byId('prioridad').value='Media'; byId('estado').value='Abierta';
}
function validar(){
  const req=['codigo','fecha','solicitante','equipo','prioridad','estado'];
  for(const id of req){ if(!byId(id).value.trim()){ alert('Completa: '+id); return false; } }
  return true;
}
function guardarOT(){
  if(!validar()) return;
  const rec={
    id: selectedId || crypto.randomUUID(),
    codigo: byId('codigo').value.trim(),
    fecha: byId('fecha').value || hoyISO(),
    solicitante: byId('solicitante').value.trim(),
    equipo: byId('equipo').value.trim(),
    ubicacion: byId('ubicacion').value.trim(),
    prioridad: byId('prioridad').value,
    descripcion: byId('descripcion').value.trim(),
    estado: byId('estado').value,
    responsable: byId('responsable').value.trim(),
    fechaCierre: byId('fechaCierre').value || '',
    observaciones: byId('observaciones').value.trim(),
    ts: Date.now()
  };
  const i = data.findIndex(x=>x.id===rec.id);
  if(i>=0) data[i]=rec; else data.unshift(rec);
  localStorage.setItem(KEY, JSON.stringify(data));
  selectedId = rec.id; byId('otId').value=rec.id;
  renderTabla();
  alert('OT guardada.');
}
function imprimirOT(){ window.print(); }

/* Table */
function renderTabla(){
  const q = byId('q').value.toLowerCase();
  const fe = byId('fEstado').value;
  const fp = byId('fPrioridad').value;
  const tbody = document.querySelector('#tablaOT tbody');
  tbody.innerHTML = '';
  const filtered = data.filter(r=>{
    const hit = (r.codigo+r.equipo+r.solicitante).toLowerCase().includes(q);
    const okE = fe? r.estado===fe : true;
    const okP = fp? r.prioridad===fp : true;
    return hit && okE && okP;
  });
  for(const r of filtered){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.codigo}</td>
      <td>${r.fecha||''}</td>
      <td>${r.equipo||''}</td>
      <td>${r.solicitante||''}</td>
      <td>${badgePri(r.prioridad)}</td>
      <td>${badgeEstado(r.estado)}</td>
    `;
    tr.style.cursor='pointer';
    tr.onclick = ()=> { cargarEnFormulario(r.id); };
    tbody.appendChild(tr);
  }
  if(selectedId){
    const r=data.find(x=>x.id===selectedId);
    if(r) mostrarDetalle(r); else byId('detalle').style.display='none';
  } else byId('detalle').style.display='none';
}
function cargarEnFormulario(id){
  const r = data.find(x=>x.id===id); if(!r) return;
  selectedId = id; byId('otId').value=id;
  byId('codigo').value=r.codigo; byId('fecha').value=r.fecha||'';
  byId('solicitante').value=r.solicitante||''; byId('equipo').value=r.equipo||'';
  byId('ubicacion').value=r.ubicacion||''; byId('prioridad').value=r.prioridad||'Media';
  byId('descripcion').value=r.descripcion||''; byId('estado').value=r.estado||'Abierta';
  byId('responsable').value=r.responsable||''; byId('fechaCierre').value=r.fechaCierre||'';
  byId('observaciones').value=r.observaciones||'';
  mostrarDetalle(r);
  window.scrollTo({top:0,behavior:'smooth'});
}
function mostrarDetalle(r){
  byId('detalle').style.display='';
  byId('dCod').textContent=r.codigo||'';
  byId('dFec').textContent=r.fecha||'';
  byId('dEq').textContent=r.equipo||'';
  byId('dUb').textContent=r.ubicacion||'';
  byId('dPri').innerHTML= r.prioridad;
  byId('dEst').innerHTML= r.estado;
  byId('dResp').textContent=r.responsable||'';
  byId('dCie').textContent=r.fechaCierre||'';
  byId('dDesc').textContent=r.descripcion||'';
  byId('dObs').textContent=r.observaciones||'';
}
function eliminarSeleccionada(){
  if(!selectedId){ alert('Selecciona una OT (toca una fila).'); return; }
  if(!confirm('¿Eliminar la OT seleccionada?')) return;
  data = data.filter(x=>x.id!==selectedId);
  localStorage.setItem(KEY, JSON.stringify(data));
  selectedId=null; limpiarFormulario(); renderTabla();
}
function marcarCerrada(){
  if(!selectedId){ alert('Selecciona una OT.'); return; }
  const i = data.findIndex(x=>x.id===selectedId);
  if(i<0) return;
  data[i].estado='Cerrada';
  if(!data[i].fechaCierre) data[i].fechaCierre=hoyISO();
  localStorage.setItem(KEY, JSON.stringify(data));
  cargarEnFormulario(selectedId); renderTabla();
}

/* CSV */
function exportCSV(){
  const headers = ["codigo","fecha","solicitante","equipo","ubicacion","prioridad","estado","responsable","fechaCierre","descripcion","observaciones"];
  const rows = [headers.join(',')].concat(
    data.map(r=>headers.map(h=>('"'+(String(r[h]||'').replace(/"/g,'""'))+'"')).join(','))
  );
  const blob = new Blob([rows.join('\n')], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'AURUM_OT.csv';
  a.click();
}

/* Init */
(function init(){
  // fecha por defecto hoy
  byId('fecha').value = hoyISO();
  renderTabla();
})();
</script>
</body>
</html>